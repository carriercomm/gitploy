<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>GitPloy by felixkosmalla</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/felixkosmalla/gitploy">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/felixkosmalla/gitploy/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/felixkosmalla/gitploy/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>GitPloy</h1>
          <p>Use GitLab with GitPloy to build your own self contained Beanstalk clone. Still WIP, though</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/felixkosmalla">felixkosmalla</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        </div>

        <h1>
<a name="gitploy" class="anchor" href="#gitploy"><span class="octicon octicon-link"></span></a>GitPloy</h1>

<p>GitPloy enables you to build your own self-contained versioning and deployment system. Backed by <a href="https://www.djangoproject.com/">Django</a> it seamlessly integrates with your GitLab installation and allows you to host your repositories and push changes directly to your staging or production servers, either via remote execution of shell scripts or FTP synchronization. Deployment Hooks is inspired by Beanstalk. </p>

<h1>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h1>

<p>Since GitPloy runs with Django, the setup follows the standard steps like a normal Django installation. I made good experiences with a stack of <a href="http://nginx.org/">nginx</a>, <a href="http://supervisord.org/">supervisor</a> and <a href="http://gunicorn.org/">gunicorn</a>.</p>

<p>The following instruction is written for Ubuntu, but I'm sure it is very similar to other Linux distributions.</p>

<h2>
<a name="installing-the-stack" class="anchor" href="#installing-the-stack"><span class="octicon octicon-link"></span></a>Installing the stack</h2>

<p>Install gitlab following this instruction.
<a href="https://github.com/gitlabhq/gitlabhq/blob/master/doc/install/installation.md">https://github.com/gitlabhq/gitlabhq/blob/master/doc/install/installation.md</a></p>

<p>Install nginx</p>

<pre><code>sudo apt-get install nginx  
</code></pre>

<p>Install the python-dev package</p>

<pre><code>sudo apt-get install python-dev
</code></pre>

<p>Install PIP, the package manager for python. <a href="http://pip.readthedocs.org/en/latest/installing.html">Read the original instruction</a></p>

<pre><code>mkdir downloads
wget https://bootstrap.pypa.io/get-pip.py
sudo python get-pip.py
</code></pre>

<p>Install supervisor and <a href="https://virtualenv.pypa.io/en/latest/">virtualenv</a></p>

<pre><code>sudo apt-get install supervisor
sudo pip install virtualenv
</code></pre>

<h2>
<a name="create-a-system-user" class="anchor" href="#create-a-system-user"><span class="octicon octicon-link"></span></a>Create a System User</h2>

<p>Ok, you have the basics now, let's create a system user and a ssh key. Chose the default settings for the ssh key.</p>

<pre><code>sudo adduser --disabled-login --gecos 'GitPloy' gitploy
sudo su gitploy
ssh-keygen -t rsa
</code></pre>

<p>We also need to disable host-key checking for your repository machine.</p>

<pre><code>echo -e "Host git.YOUR_COMPANY.org\n\tStrictHostKeyChecking no\n" &gt;&gt; ~/.ssh/config
</code></pre>

<h2>
<a name="get-the-latest-gitploy-" class="anchor" href="#get-the-latest-gitploy-"><span class="octicon octicon-link"></span></a>Get the Latest GitPloy </h2>

<p>We store all the GitPloy files in our new user's home directory</p>

<pre><code>cd ~
mkdir gitploy
cd gitploy

git clone https://github.com/felixkosmalla/gitploy.git .
git checkout 1-0-stable
</code></pre>

<h2>
<a name="create-a-virtual-environment-and-activate-it" class="anchor" href="#create-a-virtual-environment-and-activate-it"><span class="octicon octicon-link"></span></a>Create a Virtual Environment and Activate it</h2>

<pre><code>cd ~
virtualenv env
source env/bin/activate
</code></pre>

<h2>
<a name="install-the-requirements" class="anchor" href="#install-the-requirements"><span class="octicon octicon-link"></span></a>Install the Requirements</h2>

<p>Your virtual environment still has to be activated</p>

<pre><code>cd ~
cd gitploy
pip install --pre -r requirements.txt
</code></pre>

<h2>
<a name="install-a-database" class="anchor" href="#install-a-database"><span class="octicon octicon-link"></span></a>Install a Database</h2>

<p>If you want, you can install a database like Postgres or MySQL but you can also run the installation on Sqlite which is the default setting. For this you have to do nothing.</p>

<p>TODO: Postgres installation</p>

<h2>
<a name="edit-you-local-settings" class="anchor" href="#edit-you-local-settings"><span class="octicon octicon-link"></span></a>Edit You Local Settings</h2>

<pre><code>cd ~
cd gitploy
cd gitlab_deployment
cp settings_local_template.py settings_local.py
editor settings_local.py
</code></pre>

<p>You can find out your public key by doing</p>

<pre><code>cat ~/.ssh/id_rsa.pub
</code></pre>

<h2>
<a name="create-some-directories" class="anchor" href="#create-some-directories"><span class="octicon octicon-link"></span></a>Create Some Directories</h2>

<pre><code>cd ~
mkdir repositories
mkdir document_root
mkdir document_root/static
mkdir logs

touch logs/supervisor.log
touch logs/supervisor_stdout.log
touch logs/supervisor_stderr.log
touch logs/nginx_access.log
touch logs/nginx_error.log
</code></pre>

<h2>
<a name="setup-your-database-and-static-files" class="anchor" href="#setup-your-database-and-static-files"><span class="octicon octicon-link"></span></a>Setup your Database and Static Files</h2>

<pre><code>cd ~
cd gitploy
./manage.py syncdb
./manage.py migrate
./manage.py collectstatic --noinput
</code></pre>

<h2>
<a name="test-your-django-installation" class="anchor" href="#test-your-django-installation"><span class="octicon octicon-link"></span></a>Test your Django Installation</h2>

<p>Wow, halfway done. Let's see if everything went right so far.</p>

<pre><code>./manage.py runserver 0.0.0.0:8000
</code></pre>

<p>You see something that is not an error page? Good job, let's continue!</p>

<h2>
<a name="configure-nginx" class="anchor" href="#configure-nginx"><span class="octicon octicon-link"></span></a>Configure Nginx</h2>

<p>Find the line where it says <em>server_name</em> and change that according to the desired URL of your gitploy installation. We than create a symlink to the sites configuration of nginx.</p>

<pre><code>cd ~
editor gitploy/server_conf/gitploy_nginx
</code></pre>

<p>We need to do this as sudo, so exit from the user <em>gitploy</em> and create some symlinks.</p>

<pre><code>exit
sudo ln -s /home/gitploy/gitploy/server_conf/gitploy_nginx /etc/nginx/sites-available/
sudo ln -s /etc/nginx/sites-available/gitploy_nginx /etc/nginx/sites-enabled/
</code></pre>

<p>Restart nginx</p>

<pre><code>sudo service nginx restart
</code></pre>

<p>You may have to uncomment <em>server_names_hash_bucket_size 64</em></p>

<pre><code>editor /etc/nginx/nginx.conf
</code></pre>

<h2>
<a name="configure-supervisor" class="anchor" href="#configure-supervisor"><span class="octicon octicon-link"></span></a>Configure Supervisor</h2>

<p>Create a symlink to the supervisor configuration.</p>

<pre><code>sudo ln -s /home/gitploy/gitploy/server_conf/gitploy_supervisor.conf /etc/supervisor/conf.d/
</code></pre>

<p>Restart supervisor</p>

<pre><code>sudo service supervisor restart
</code></pre>

<h2>
<a name="done" class="anchor" href="#done"><span class="octicon octicon-link"></span></a>Done!</h2>

<p>Congrats! Your installation should now be up and running. Happy Deploying!</p>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>